{% extends "base.html" %}

{% block title %}Mot de passe oubli&eacute; - MyDoc Intelligence{% endblock %}

{% block content %}
<div class="auth-container">
    <h1>Mot de passe oubli&eacute;</h1>

    <p class="text-muted mb-4">
        Entrez votre adresse email et nous vous enverrons un lien pour r&eacute;initialiser votre mot de passe.
    </p>

    <div id="successMessage" class="alert alert-success d-none" role="alert">
        Si un compte existe avec cet email, un lien de r&eacute;initialisation a &eacute;t&eacute; envoy&eacute;.
    </div>

    <form id="forgotPasswordForm" method="post">
        <div class="mb-3">
            <label for="email" class="form-label">E-mail</label>
            <input type="email" class="form-control" id="email" name="email" required
                   placeholder="votre@email.com">
        </div>

        <button type="submit" class="btn btn-primary w-100">Envoyer le lien</button>
    </form>

    <div class="mt-3 text-center">
        <a href="/login" class="text-decoration-none">Retour &agrave; la connexion</a>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
document.getElementById('forgotPasswordForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const email = document.getElementById('email').value;

    try {
        const response = await fetch('/auth/forgot-password', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ email })
        });

        // Always show success message to prevent email enumeration
        document.getElementById('forgotPasswordForm').classList.add('d-none');
        document.getElementById('successMessage').classList.remove('d-none');

    } catch (error) {
        console.error('Error:', error);
        // Still show success message
        document.getElementById('forgotPasswordForm').classList.add('d-none');
        document.getElementById('successMessage').classList.remove('d-none');
    }
});
</script>
{% endblock %}
